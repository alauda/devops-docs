---
weight: 30
sourceSHA: fef3d229b476ad774bed3ada6ed41139b1446f42721e307618e142e5e3d2fdd0
---

# Установка Alauda DevOps

Это руководство содержит подробные шаги для установки `Alauda DevOps`.

## Предварительные условия

Убедитесь, что следующие операторы установлены перед продолжением:

- Оператор `Alauda DevOps v3`

## Место развертывания

Развертывайте экземпляры Katanomi в глобальном кластере. Бизнес-кластер может развертывать экземпляры по мере необходимости для CI/CD.

<table>
  <tr>
    <th style={{ whiteSpace: 'nowrap' }}>Компонент</th>
    <th style={{ whiteSpace: 'nowrap' }}>Глобальный кластер</th>
    <th style={{ whiteSpace: 'nowrap' }}>Бизнес-кластер</th>
  </tr>

  <tr>
    <td>Katanomi</td>
    <td>Установлен</td>
    <td>По желанию</td>
  </tr>
</table>

## Процедура

<Steps>
### Создание экземпляра Katanomi

:::warning

Поддерживается только один экземпляр Katanomi.

- **Глобальный кластер**: Развернуть в пространстве имен `cpaas-system`. Установите `ExternalURL` в `Platform URL` глобального кластера и `Service.Type` на `Ingress`.

- **Бизнес-кластер**: Развертывание поддерживается в любом пространстве имен.

:::

- Войдите на платформу `Alauda Container Platform`.

- Перейдите на вкладку **Кластеры** в разделе `Управление платформой`.

- Выберите развернутый кластер и нажмите **CLI Tools**.

- Для глобального кластера выполните следующее, чтобы получить `ExternalURL`:

```shell
export EXTERNAL_URL=$(kubectl get prdb -n cpaas-system base -o jsonpath='{.spec.platformURL}')
```

- Создайте экземпляр Katanomi (при необходимости отрегулируйте параметры)

```shell
cat <<EOF | kubectl apply -f -
apiVersion: operators.katanomi.dev/v1alpha1
kind: Katanomi
metadata:
  name: katanomi
  namespace: cpaas-system
spec:
  externalURL: ${EXTERNAL_URL}
  replicas: 1
  resources:
    limits:
      cpu: "2"
      memory: 4Gi
    requests:
      cpu: "1"
      memory: 2Gi
  service:
    ingress:
      protocol: HTTP
    type: Ingress
EOF
```

- Дождитесь, пока экземпляр DevOps будет готов

```shell
kubectl wait --for='jsonpath={.status.conditions[?(@.type=="Running")].status}=true' katanomis/katanomi -n cpaas-system --timeout=5m
```

### Подготовка к функциональности CI/CD

Перед началом использования функций конвейеров сборки и выпуска Alauda DevOps администраторы платформы должны завершить некоторые подготовки.

См. документацию внутри платформы после развертывания Alauda DevOps v3: `<Platform URL>/console-devops-docs/en/devops-initialization/cicd/init/`

</Steps>

## Описание параметров Katanomi

<table>
  <tr>
    <th style={{ whiteSpace: 'nowrap' }}>Параметр</th>
    <th style={{ whiteSpace: 'nowrap' }}>Описание</th>
  </tr>

  <tr>
    <td><b>Имя</b></td>

    <td>
      Имя экземпляра Katanomi.
    </td>
  </tr>

  <tr>
    <td><b>Пространства имен</b></td>

    <td>
      Для `бизнес кластеров` экземпляр Katanomi может быть развернут в любом пространстве имен, при условии, что есть достаточные ресурсы. Для `глобального кластера` экземпляр Katanomi должен быть развернут исключительно в пространстве имен `cpaas-system`.
    </td>
  </tr>

  <tr>
    <td><b>Внешний URL</b></td>

    <td>
      Адрес доступа, который является адресом API. Планируйте в соответствии с конфигурацией типа службы.<br />Когда тип службы `Node Port`, пожалуйста, введите `http://<IP>:<Port>`. **Порт** должен соответствовать `Node Port` службы, а API-порт используется для доступа к службе.<br />Когда тип службы `Ingress`, пожалуйста, введите соответствующий адрес доступа, например: `http://kubernetes.io`.
    </td>
  </tr>

  <tr>
    <td><b>Реплики</b></td>

    <td>
      Количество реплик для развертывания, по умолчанию 2. <br />
      Когда количество реплик равно 1, используется одноузловое развертывание.
    </td>
  </tr>

  <tr>
    <td><b>Ресурсы</b></td>

    <td>
      - <b>requests:</b> Минимальное количество ресурсов CPU и памяти, которые могут быть потреблены при запуске инструмента.
      - <b>limits:</b> Максимальное количество ресурсов CPU и памяти, которые необходимо занять при запуске инструмента.
    </td>
  </tr>

  <tr>
    <td><b>Service.Type</b></td>

    <td>
      Обязательное поле. Предоставляет два типа: Node Port и Ingress.

      - <b>Node Port:</b> Открывает маршрут через статический порт, доступный по адресу `<IP>:<port>`.
      - <b>Ingress:</b> Открывает маршрут через входящие правила, доступный по доменному имени.
    </td>
  </tr>

  <tr>
    <td><b>Service.Ingress</b></td>

    <td>
      Требуется, если тип установлен в Ingress.

      - <b>Доменное имя:</b> Доменное имя, используемое для доступа к инструменту.
      - <b>Протокол:</b> Доступ к инструменту через HTTP или HTTPS.
      - <b>Имя секрета:</b> Имя SSL-сертификата, используемое при доступе к инструменту через HTTPS.
    </td>
  </tr>

  <tr>
    <td><b>Service.Node Port</b></td>

    <td>
      Требуется, если <b>Type</b> установлен в <b>Node Port</b>. Номер порта, используемый для доступа к инструменту, API-порт и порт плагина не могут дублироваться, а диапазон значений порта составляет 30000-32767.

      - <b>API Port:</b> Порт, используемый для доступа к компоненту Katanomi-api через HTTP, который используется для выполнения операций, связанных с интеграцией инструментов.
      - <b>Plugin Port:</b> Порт, используемый для доступа к компоненту Katanomi-plugin через HTTP, который используется на платформе для обработки событий интеграции инструментов.
    </td>
  </tr>
</table>
