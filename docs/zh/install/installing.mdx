---
weight: 30
i18n:
  disableAutoTranslation: true
  title:
    en: Installing
---

# 安装

本节介绍安装 `global` 集群的具体步骤。

在开始安装之前，请确保已完成先决条件检查、安装包下载与校验、节点预处理等准备工作。

## 流程

<Steps>
### 安装包上传与解压

将安装包上传到 `global` 集群控制节点的任意机器，并按照以下命令解压安装包：

```shell
# 假定机器上已存在 /root/cpaas-install 文件夹
tar -xvf {安装包文件路径}/{安装包文件名} -C /root/cpaas-install
cd /root/cpaas-install/installer || exit 1
```

<Directive type="info" title="INFO">
- 该机器将在 `global` 集群安装完成后成为第一个控制节点。
- 安装包解压后至少需要 **100GB** 的磁盘空间，请确保存储资源充足。
</Directive>

### 启动安装器

执行以下安装脚本，启动安装器。安装器启动成功后，命令行终端将输出 UI 访问地址。

等待约 5 分钟后，您可以在 PC 上使用浏览器访问安装器提供的 Web UI。

```bash
bash setup.sh
```

安装器默认使用 Kube-OVN 网络插件。如需使用 Calico 网络插件，请执行：

```bash
bash setup.sh --network-mode calico
```

<Directive type="note" title="其他参数">
- 使用 IPv6 地址访问：追加 `--ip-family ipv6` 参数。
- 同时支持 IPv4 和 IPv6：追加 `--ip-family dual` 参数。
</Directive>

<Directive type="warning" title="注意">
确保安装器所在节点的 IP 地址和 8080 端口可正常访问，以便安装器启动成功后能够顺利访问其提供的 Web UI。
</Directive>

### 参数配置

根据页面引导完成安装参数配置后，确认安装。

[参数说明](#parameters) 中提供了关键参数的详细说明，请仔细阅读并根据实际需求进行配置。

### 验证安装成功

安装完成后，页面将显示平台访问地址。点击 **访问** 按钮可跳转至平台 Web UI。

在 **平台管理** 视图中，依次点击 **集群管理 > 集群**，找到名称为 `global` 的集群。

通过右侧下拉菜单选择 `CLI 工具`，执行以下命令以验证安装状态：

```shell
# 查看是否有失败的 Chart
kubectl get apprelease --all-namespaces
# 查看是否有失败的 Pod
kubectl get pod --all-namespaces | awk '{if ($4 != "Running" && $4 != "Completed")print}' | awk -F'[/ ]+' '{if ($3 != $4)print}'
```
</Steps>

## 参数说明 \{#parameters}

<table>
  <tr>
    <th style={{ whiteSpace: 'nowrap' }}>参数</th>
    <th style={{ whiteSpace: 'nowrap' }}>说明</th>
  </tr>
  <tr>
    <td><b>Kubernetes 版本</b></td>
    <td>
      可选版本均经过严格测试，确保稳定性和兼容性。<br />
      <b>建议：</b> 选择最新版本以获取最佳功能和支持。
    </td>
  </tr>
  <tr>
    <td><b>集群的网络协议</b></td>
    <td>
      支持三种模式：IPv4 单栈、IPv6 单栈、IPv4/IPv6 双栈。<br />
      <b>注意：</b> 如果选择双栈模式，请确保所有节点正确配置 IPv6 地址；网络协议一旦设置，后续无法更改。
    </td>
  </tr>
  <tr>
    <td><b>集群地址</b></td>
    <td>
      <ul>
        输入预先准备好的域名。若无域名，则输入预先准备好的 <code>global VIP</code> 。<br />
        <code>自建 VIP</code> 默认关闭，仅当您未提供 LoadBalancer 时，才需要开启。开启后安装器将自动部署 <code>keepalived</code> 提供软负载支持。<br />
        <b>注意：</b> 使用 <code>自建 VIP</code> 时需满足以下条件，<br />
        - 已有可用的 VRID；<br />
        - 主机网络支持 VRRP 协议；<br />
        - 所有控制节点和 VIP 必须位于同一子网。<br />
      </ul>
      <ul>
        <b>提示：</b>功能体验场景下的 <b>单节点部署</b>，可直接输入节点 IP 。无需开启 <code>自建 VIP</code> ，也不需要准备 <code>global VIP</code> 等网络资源。
      </ul>
    </td>
  </tr>
  <tr>
    <td><b>平台访问地址</b></td>
    <td>
      <ul>
        若您不需要区分 <b>集群地址</b >与 <b>平台访问地址</b> ，则输入与 <b>集群地址</b> 相同的地址。<br />
        若您需要区分，比如 global 集群仅供内网访问，平台需要提供外网访问，则输入预先准备好的域名或 <code>External IP</code> 。<br />
        平台默认使用 HTTPS 访问且不开启 HTTP 。若需开启 HTTP 访问，请在 <b>高级设置</b> 中开启（不推荐）。<br />
        <b>注意：</b>下列情况必须输入域名，<br />
        - 计划实施 global 集群的容灾方案；<br />
        - 平台需要支持 IPv6 访问。<br />
      </ul>
      <ul>
        <b>提示：</b>如果需要配置更多的平台访问地址，可在下一步的 <b>其他设置 &gt; 平台其他访问地址</b> 中添加。或安装完成后，参考用户手册在平台管理添加。<br />
      </ul>
    </td>
  </tr>
  <tr>
    <td><b>证书</b></td>
    <td>
      平台默认提供自签证书支持 HTTPS 访问。<br />
      如需使用自定义证书，可上传已有证书。
    </td>
  </tr>
  <tr>
    <td><b>镜像仓库</b></td>
    <td>
      默认使用 <code>平台部署</code> 镜像仓库，其中包含所有组件的镜像。<br />
      若需使用 <code>外部</code> 镜像仓库，请联系技术支持获取镜像同步方案后进行配置。
    </td>
  </tr>
  <tr>
    <td><b>容器网络</b></td>
    <td>
      集群的默认子网和 Service 网段不可重叠。<br />
      使用 Kube-OVN Overlay 网络时，需确保容器网络与宿主机网络不在同一网段，否则可能导致网络异常。
    </td>
  </tr>
  <tr>
    <td><b>节点名称</b></td>
    <td>
      如果选择 <code>主机名称作为节点名称</code>，请确保所有节点的主机名称唯一。
    </td>
  </tr>
  <tr>
    <td><b>global 集群平台节点隔离</b></td>
    <td>
      仅当计划在 `global` 集群运行应用工作负载时启用。<br />
      <b>启用后：</b><br />
      - 节点可设置为 <code>平台独占</code>，即只运行平台组件，确保平台和应用工作负载相互隔离；<br />
      - DaemonSet 类型的工作负载除外。
    </td>
  </tr>
  <tr>
    <td><b>添加节点</b></td>
    <td>
      <b>控制节点：</b>
      <ul>
        - 支持添加 1 个或 3 个控制节点（3 个为高可用配置）；<br />
        - 若启用 <code>平台独占</code>，则强制关闭 <code>可部署应用</code>，控制节点仅运行平台组件；<br />
        - 若关闭 <code>平台独占</code>，可选择是否启用 <code>可部署应用</code>，允许控制节点运行应用工作负载。<br />
      </ul>

      <b>计算节点：</b>
      <ul>
        - 若启用 <code>平台独占</code>，强制关闭 <code>可部署应用</code>；<br />
        - 若关闭 <code>平台独占</code>，强制启用 <code>可部署应用</code>。<br />
      </ul>

      <p>使用 Kube-OVN 时，可通过输入网关名称指定节点网卡。</p>
      <p>如果节点可用性检查未通过，请根据页面提示调整后重新添加。</p>
    </td>
  </tr>
</table>

## 安装器清理

通常情况下，安装器会在安装完成后自动删除。若安装器在安装完成后超过 30 分钟仍未自动删除，请在安装器所在的节点执行以下命令，强制删除安装器容器：
```bash
docker rm -f minialauda-control-plane
```
